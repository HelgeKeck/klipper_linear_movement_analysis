[mcu adxl]
serial: /dev/serial/by-id/usb-Klipper_rp2040_E6626005A71B4F34-if00
                                      
[adxl345]
cs_pin: adxl:gpio9
spi_software_sclk_pin: adxl:gpio10
spi_software_mosi_pin: adxl:gpio11
spi_software_miso_pin: adxl:gpio12

[resonance_tester]
accel_chip:adxl345
probe_points:
    147,154, 20

[linear_movement_vibrations]
accel_chip: adxl345
x_min: 5
x_max: 175
y_min: 5
y_max: 175
output_directory: /tmp/linear_vibrations/

[gcode_macro test_accel]
gcode:
  ACCELEROMETER_QUERY

[gcode_macro X_INPUTSHAPER]
gcode:
  _CG28
  TEST_RESONANCES AXIS=X

[gcode_macro Y_INPUTSHAPER]
gcode:
  _CG28
  TEST_RESONANCES AXIS=Y

[gcode_macro _CG28]
gcode:
    {% if "xyz" not in printer.toolhead.homed_axes %}
        G28
    {% endif %}

[gcode_macro Linear_vibration_const_speed]
description: Run linear vibration for x,y,a,b axis at one velocity
gcode:
  _CG28
  G1 Z20
  {% set speed = params.SPEED|default(150)|int %} 
  {% set axis = params.AXIS|string %}
  MEASURE_LINEAR_VIBRATIONS VELOCITY={speed} AXIS={axis}

[gcode_macro Linear_vibration_speed_range]
description: Run linear vibration for x,y,a,b axis at one velocity
gcode:
  _CG28
  G1 Z20
  {% set axis = params.AXIS|string %}
  {% set vmin = params.VMIN|default(50)|int %}
  {% set vmax = params.VMAX|default(250)|int %}
  {% set step = params.STEP|default(10)|int %}
  
  MEASURE_LINEAR_VIBRATIONS_RANGE AXIS={axis} VMIN={vmin} VMAX={vmax} STEP={step}
